openapi: 3.0.3
info:
  title: CoreMs Auth Service API
  description: |
    OAuth2 Authorization Server and OpenID Connect.
    Provider with first-party authentication extensions and user management.
    
    **Standard OAuth2/OIDC Endpoints:**
    - Token endpoint: `/oauth2/token` (signin, refresh)
    - UserInfo endpoint: `/oauth2/userinfo` (profile)
    - Revocation endpoint: `/oauth2/revoke` (signout)
    - Discovery: `/.well-known/openid-configuration`
    - JWKS: `/.well-known/jwks.json`
    
    **Custom Extensions:**
    - User registration and verification
    - Password reset flows
    - Admin user management
  version: 1.0.0


servers:
  - url: /
    description: Default server

tags:
  - name: OAuth2
    description: Standard OAuth2 token operations
  - name: OIDC
    description: OpenID Connect endpoints
  - name: Registration
    description: User registration and verification
  - name: Password
    description: Password management
  - name: Profile
    description: User profile management
  - name: Admin
    description: Administrative user management

x-common-error-responses: &common-error-responses
  '400':
    $ref: '.gen/common-api.yaml#/components/responses/ValidationError'
  '401':
    $ref: '.gen/common-api.yaml#/components/responses/UnauthorizedError'
  '404':
    $ref: '.gen/common-api.yaml#/components/responses/NotFoundError'
  '500':
    $ref: '.gen/common-api.yaml#/components/responses/InternalServerError'

security:
  - bearerAuth: []

paths:
  # ============================================================================
  # OAUTH2/OIDC ENDPOINTS
  # ============================================================================
  
  /.well-known/openid-configuration:
    get:
      tags:
        - OIDC
      summary: OpenID Connect discovery document
      operationId: getOidcConfiguration
      security: []
      responses:
        '200':
          description: OIDC configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OidcConfiguration'

  /.well-known/jwks.json:
    get:
      tags:
        - OIDC
      summary: JSON Web Key Set (public keys for JWT validation)
      operationId: getJwks
      security: []
      responses:
        '200':
          description: JWKS response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JwksResponse'

  /oauth2/authorize:
    get:
      tags:
        - OAuth2
      summary: OAuth2 authorization endpoint (authorization code flow)
      operationId: authorize
      security: []
      parameters:
        - name: response_type
          in: query
          required: true
          schema:
            type: string
            enum: [code]
        - name: client_id
          in: query
          required: true
          schema:
            type: string
        - name: redirect_uri
          in: query
          required: true
          schema:
            type: string
            format: uri
        - name: scope
          in: query
          schema:
            type: string
            example: openid profile email
        - name: state
          in: query
          required: true
          schema:
            type: string
          description: CSRF protection token
        - name: code_challenge
          in: query
          required: true
          schema:
            type: string
          description: PKCE code challenge (SHA256 of code_verifier, base64url-encoded)
        - name: code_challenge_method
          in: query
          required: true
          schema:
            type: string
            enum: [S256]
        - name: nonce
          in: query
          schema:
            type: string
          description: Optional nonce for ID token
      responses:
        '302':
          description: Redirect to login or callback with authorization code
        '400':
          $ref: '.gen/common-api.yaml#/components/responses/ValidationError'

  /oauth2/token:
    post:
      tags:
        - OAuth2
      summary: OAuth2 token endpoint
      description: |
        Supports multiple grant types:
        - `password`: First-party apps only (deprecated for third-party)
        - `authorization_code`: Standard OAuth2 flow with PKCE
        - `refresh_token`: Refresh access tokens
      operationId: token
      security: []
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - grant_type
              properties:
                grant_type:
                  type: string
                  enum: [password, authorization_code, refresh_token]
                
                # Password grant (first-party only)
                username:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
                
                # Authorization code grant
                code:
                  type: string
                redirect_uri:
                  type: string
                code_verifier:
                  type: string
                  description: PKCE code verifier
                
                # Refresh token grant
                refresh_token:
                  type: string
                
                # Optional
                scope:
                  type: string
                client_id:
                  type: string
            examples:
              password_grant:
                summary: Password grant (first-party)
                value:
                  grant_type: password
                  username: user@example.com
                  password: StrongPass1!
                  scope: openid profile email
              authorization_code_grant:
                summary: Authorization code grant (PKCE)
                value:
                  grant_type: authorization_code
                  code: abc123def456
                  redirect_uri: http://localhost:8080/callback
                  code_verifier: dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk
                  client_id: corems-frontend
              refresh_grant:
                summary: Refresh token
                value:
                  grant_type: refresh_token
                  refresh_token: eyJ0eXAiOi...
      responses:
        '200':
          description: Token issued successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OAuth2TokenResponse'
        '400':
          $ref: '.gen/common-api.yaml#/components/responses/ValidationError'
        '401':
          $ref: '.gen/common-api.yaml#/components/responses/UnauthorizedError'

  /oauth2/revoke:
    post:
      tags:
        - OAuth2
      summary: Revoke token (signout)
      description: |
        Standard OAuth2 token revocation endpoint (RFC 7009).
        Revokes access or refresh tokens.
      operationId: revokeToken
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - token
              properties:
                token:
                  type: string
                  description: Token to revoke (access or refresh)
                token_type_hint:
                  type: string
                  enum: [access_token, refresh_token]
                  description: Hint about token type (optional)
      responses:
        '200':
          description: Token revoked successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessfulResponse'
        '401':
          $ref: '.gen/common-api.yaml#/components/responses/UnauthorizedError'

  /oauth2/userinfo:
    get:
      tags:
        - OIDC
      summary: Get current user info (profile)
      description: Standard OIDC UserInfo endpoint
      operationId: getUserInfo
      responses:
        '200':
          description: User information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OidcUserInfo'
        <<: *common-error-responses

  # ============================================================================
  # REGISTRATION & VERIFICATION (Custom - No OAuth2 Standard)
  # ============================================================================

  /api/auth/signup:
    post:
      tags:
        - Registration
      summary: Register new user account
      operationId: signUp
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignUpRequest'

      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessfulResponse'
        <<: *common-error-responses

  /api/auth/verify-email:
    post:
      tags:
        - Registration
      summary: Verify email address with confirmation token
      operationId: verifyEmail
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyEmailRequest'

      responses:
        '200':
          description: Email verified successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessfulResponse'
        <<: *common-error-responses

  /api/auth/verify-phone:
    post:
      tags:
        - Registration
      summary: Verify phone number with confirmation code
      operationId: verifyPhone
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyPhoneRequest'

      responses:
        '200':
          description: Phone verified successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessfulResponse'
        <<: *common-error-responses

  /api/auth/resend-verification:
    post:
      tags:
        - Registration
      summary: Resend verification code/link
      operationId: resendVerification
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResendVerificationRequest'

      responses:
        '200':
          description: Verification code/link sent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessfulResponse'
        <<: *common-error-responses

  # ============================================================================
  # PASSWORD MANAGEMENT (Custom)
  # ============================================================================

  /api/auth/forgot-password:
    post:
      tags:
        - Password
      summary: Request password reset link
      operationId: forgotPassword
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForgotPasswordRequest'

      responses:
        '200':
          description: Password reset link sent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessfulResponse'
        <<: *common-error-responses

  /api/auth/reset-password:
    post:
      tags:
        - Password
      summary: Reset password with token
      operationId: resetPassword
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'

      responses:
        '200':
          description: Password reset successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessfulResponse'
        <<: *common-error-responses

  # ============================================================================
  # PROFILE MANAGEMENT
  # ============================================================================

  /api/profile:
    patch:
      tags:
        - Profile
      summary: Update current user profile
      operationId: updateProfile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProfileUpdateRequest'

      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OidcUserInfo'
        <<: *common-error-responses

  /api/profile/change-password:
    post:
      tags:
        - Profile
      summary: Change password for current user
      operationId: changePassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'

      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessfulResponse'
        <<: *common-error-responses

  # ============================================================================
  # ADMIN USER MANAGEMENT
  # ============================================================================

  /api/users:
    get:
      tags:
        - Admin
      summary: List all users
      operationId: getAllUsers
      parameters:
        - $ref: '.gen/common-api.yaml#/components/parameters/page'
        - $ref: '.gen/common-api.yaml#/components/parameters/pageSize'
        - $ref: '.gen/common-api.yaml#/components/parameters/sort'
        - $ref: '.gen/common-api.yaml#/components/parameters/search'
        - $ref: '.gen/common-api.yaml#/components/parameters/filter'

      responses:
        '200':
          description: User list response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsersPagedResponse'
        <<: *common-error-responses

    post:
      tags:
        - Admin
      summary: Create new user
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'

      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessfulResponse'
        <<: *common-error-responses

  /api/users/{userId}:
    get:
      tags:
        - Admin
      summary: Get user by ID
      operationId: getUserById
      parameters:
        - name: userId
          in: path
          required: true
          description: ID of the user to return
          schema:
            type: string
            format: uuid

      responses:
        '200':
          description: User info response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserInfo'
        <<: *common-error-responses
    
    patch:
      tags:
        - Admin
      summary: Update a user by ID (partial update)
      operationId: updateUserById
      parameters:
        - name: userId
          in: path
          required: true
          description: ID of the user to update
          schema:
            type: string
            format: uuid

      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserInfo'

      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessfulResponse'
        <<: *common-error-responses

    delete:
      tags:
        - Admin
      summary: Delete a user by ID
      operationId: deleteUserById
      parameters:
        - name: userId
          in: path
          required: true
          description: ID of the user to delete
          schema:
            type: string
            format: uuid

      responses:
        '200':
          description: User deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessfulResponse'
        <<: *common-error-responses

  /api/users/{userId}/change-password:
    post:
      tags:
        - Admin
      summary: Admin set/change password for a user
      operationId: adminChangeUserPassword
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminSetPasswordRequest'
      responses:
        '200':
          description: Password changed by admin
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessfulResponse'
        <<: *common-error-responses

  /api/users/{userId}/change-email:
    post:
      tags:
        - Admin
      summary: Admin change user's email (immediate)
      operationId: adminChangeUserEmail
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangeEmailRequest'
      responses:
        '200':
          description: Email changed by admin
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessfulResponse'
        <<: *common-error-responses

# ============================================================================
# SCHEMAS
# ============================================================================

components:
  schemas:
    # ========================================================================
    # OAUTH2/OIDC STANDARD SCHEMAS
    # ========================================================================
    
    OAuth2TokenResponse:
      type: object
      required:
        - access_token
        - token_type
        - expires_in
      properties:
        access_token:
          type: string
          description: JWT access token for API authorization
          example: eyJ0eXAiOiJhY2Nlc3NfdG9rZW4iLCJhbGciOiJSUzI1NiJ9...
        token_type:
          type: string
          enum: [Bearer]
          default: Bearer
          description: Token type (always Bearer)
        expires_in:
          type: integer
          description: Access token lifetime in seconds
          example: 600
        refresh_token:
          type: string
          description: JWT refresh token (for password grant)
          example: eyJ0eXAiOiJyZWZyZXNoX3Rva2VuIiwiYWxnIjoiUlMyNTYifQ...
        id_token:
          type: string
          description: |
            OpenID Connect ID Token (JWT) containing user identity claims.
            Only returned when 'openid' scope is requested.
            Contains claims: iss, sub, aud, exp, iat, auth_time, nonce (if provided).
          example: eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImNvcmVtcy0yMDI0LTAxIn0.eyJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjMwMDAiLCJzdWIiOiIyYTNlMGI1Yy0yMTkyLTQ2MTItOWUwMi02OTM5ODlkYmI3ZTUiLCJhdWQiOiJjb3JlbXMtZnJvbnRlbmQiLCJleHAiOjE3MDQwNzA4MDAsImlhdCI6MTcwNDA2NzIwMCwiYXV0aF90aW1lIjoxNzA0MDY3MjAwLCJlbWFpbCI6InVzZXJAZXhhbXBsZS5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiZ2l2ZW5fbmFtZSI6IkpvaG4iLCJmYW1pbHlfbmFtZSI6IkRvZSIsInBpY3R1cmUiOiJodHRwczovL2V4YW1wbGUuY29tL2ltYWdlcy9qb2huZG9lLmpwZyJ9...
        scope:
          type: string
          description: Granted scopes (space-separated)
          example: openid profile email

    OidcUserInfo:
      type: object
      required:
        - sub
      properties:
        sub:
          type: string
          format: uuid
          description: Subject identifier (userId)
          example: 2a3e0b5c-2192-4612-9e02-693989dbb7e5
        email:
          type: string
          format: email
          example: user@example.com
        email_verified:
          type: boolean
          example: true
        phone_number:
          type: string
          example: +15551234567
        phone_number_verified:
          type: boolean
          example: false
        given_name:
          type: string
          description: First name
          example: John
        family_name:
          type: string
          description: Last name
          example: Doe
        picture:
          type: string
          format: uri
          example: https://example.com/images/johndoe.jpg
        updated_at:
          type: integer
          description: Unix timestamp of last update
          example: 1704067200
        roles:
          type: array
          description: User roles (custom claim)
          items:
            type: string
          example: [USER, ADMIN]
        provider:
          type: string
          description: Auth provider (custom claim)
          example: local

    OidcConfiguration:
      type: object
      properties:
        issuer:
          type: string
          example: http://localhost:3000
        authorization_endpoint:
          type: string
          example: http://localhost:3000/oauth2/authorize
        token_endpoint:
          type: string
          example: http://localhost:3000/oauth2/token
        userinfo_endpoint:
          type: string
          example: http://localhost:3000/oauth2/userinfo
        jwks_uri:
          type: string
          example: http://localhost:3000/.well-known/jwks.json
        registration_endpoint:
          type: string
          example: http://localhost:3000/api/auth/signup
        revocation_endpoint:
          type: string
          example: http://localhost:3000/oauth2/revoke
        scopes_supported:
          type: array
          items:
            type: string
          example: [openid, profile, email, phone]
        response_types_supported:
          type: array
          items:
            type: string
          example: [code, token]
        grant_types_supported:
          type: array
          items:
            type: string
          example: [password, authorization_code, refresh_token]
        subject_types_supported:
          type: array
          items:
            type: string
          example: [public]
        id_token_signing_alg_values_supported:
          type: array
          items:
            type: string
          example: [RS256]
        token_endpoint_auth_methods_supported:
          type: array
          items:
            type: string
          example: [client_secret_post, client_secret_basic, none]
        code_challenge_methods_supported:
          type: array
          items:
            type: string
          example: [S256]
          description: PKCE code challenge methods

    JwksResponse:
      type: object
      required:
        - keys
      properties:
        keys:
          type: array
          items:
            type: object
            properties:
              kty:
                type: string
                description: Key type
                example: RSA
              use:
                type: string
                description: Key use
                example: sig
              kid:
                type: string
                description: Key ID
                example: corems-2024-01
              alg:
                type: string
                description: Algorithm
                example: RS256
              n:
                type: string
                description: RSA modulus (base64url)
              e:
                type: string
                description: RSA exponent (base64url)
                example: AQAB

    IdTokenClaims:
      type: object
      description: |
        OpenID Connect ID Token claims (JWT payload).
        This is for documentation only - the actual id_token is a signed JWT string.
      required:
        - iss
        - sub
        - aud
        - exp
        - iat
      properties:
        iss:
          type: string
          description: Issuer identifier (user-ms URL)
          example: http://localhost:3000
        sub:
          type: string
          format: uuid
          description: Subject identifier (userId)
          example: 2a3e0b5c-2192-4612-9e02-693989dbb7e5
        aud:
          type: string
          description: Audience (client_id or service identifier)
          example: corems-frontend
        exp:
          type: integer
          description: Expiration time (Unix timestamp)
          example: 1704070800
        iat:
          type: integer
          description: Issued at time (Unix timestamp)
          example: 1704067200
        auth_time:
          type: integer
          description: Time when authentication occurred (Unix timestamp)
          example: 1704067200
        nonce:
          type: string
          description: Nonce value from authorization request (if provided)
          example: abc123xyz789
        email:
          type: string
          format: email
          description: User's email (if 'email' scope granted)
          example: user@example.com
        email_verified:
          type: boolean
          description: Email verification status (if 'email' scope granted)
          example: true
        given_name:
          type: string
          description: First name (if 'profile' scope granted)
          example: John
        family_name:
          type: string
          description: Last name (if 'profile' scope granted)
          example: Doe
        picture:
          type: string
          format: uri
          description: Profile picture URL (if 'profile' scope granted)
          example: https://example.com/images/johndoe.jpg
        phone_number:
          type: string
          description: Phone number (if 'phone' scope granted)
          example: +15551234567
        phone_number_verified:
          type: boolean
          description: Phone verification status (if 'phone' scope granted)
          example: false

    # ========================================================================
    # APPLICATION-SPECIFIC SCHEMAS
    # ========================================================================
    
    Password:
      type: string
      format: password
      minLength: 8
      maxLength: 128
      description: |
        Password requirements:
        - At least 8 characters
        - At least one letter
        - At least one digit
      pattern: '^(?=.*[a-zA-Z])(?=.*\d).{8,}$'
      example: StrongPass1!

    ConfirmPassword:
      type: string
      format: password
      minLength: 8
      maxLength: 128
      description: Confirmation of the password, should match the password field
      example: StrongPass1!

    SignUpRequest:
      type: object
      required:
        - email
        - password
        - confirmPassword
        - firstName
        - lastName
      properties:
        firstName:
          type: string
          description: The user's first name
          maxLength: 100
          example: John
        lastName:
          type: string
          description: The user's last name
          maxLength: 100
          example: Doe
        email:
          type: string
          format: email
          maxLength: 254
          description: The user's email address
          example: user@example.com
        password:
          $ref: '#/components/schemas/Password'
        confirmPassword:
          $ref: '#/components/schemas/ConfirmPassword'
        phoneNumber:
          type: string
          pattern: '^\+\d{1,20}$'
          maxLength: 20
          description: Optional E.164 phone number for the user (e.g. +15551234567)
          example: +15551234567
        imageUrl:
          type: string
          maxLength: 2048
          description: Optional URL to the user's profile image
          example: https://example.com/images/johndoe.jpg

    ProfileUpdateRequest:
      type: object
      properties:
        firstName:
          type: string
          maxLength: 100
          example: John
        lastName:
          type: string
          maxLength: 100
          example: Doe
        phoneNumber:
          type: string
          pattern: '^\+\d{1,20}$'
          maxLength: 20
          example: +15551234567
        imageUrl:
          type: string
          maxLength: 2048
          example: https://example.com/images/johndoe.jpg

    CreateUserRequest:
      type: object
      properties:
        firstName:
          type: string
          description: The user's first name
          maxLength: 100
          example: John
        lastName:
          type: string
          description: The user's last name
          maxLength: 100
          example: Doe
        phoneNumber:
          type: string
          pattern: '^\+\d{1,20}$'
          maxLength: 20
          description: E.164 phone number for the user (e.g. +15551234567)
          example: +15551234567
        email:
          type: string
          format: email
          maxLength: 254
          description: The user's email address
          example: user@example.com
        roles:
          type: array
          description: List of roles assigned to the user
          items:
            type: string
          example: ["USER", "ADMIN"]

    VerifyEmailRequest:
      type: object
      required:
        - email
        - token
      properties:
        email:
          type: string
          format: email
          maxLength: 254
          description: The user's email address
          example: user@example.com
        token:
          type: string
          description: Email verification token received via email
          example: abc123def456

    VerifyPhoneRequest:
      type: object
      required:
        - phoneNumber
        - code
      properties:
        phoneNumber:
          type: string
          pattern: '^\+\d{1,20}$'
          maxLength: 20
          description: E.164 phone number for the user (e.g. +15551234567)
          example: +15551234567
        code:
          type: string
          pattern: '^\d{6}$'
          description: 6-digit SMS verification code
          example: "123456"

    ResendVerificationRequest:
      type: object
      required:
        - email
        - type
      properties:
        email:
          type: string
          format: email
          maxLength: 254
          description: The user's email address
          example: user@example.com
        type:
          type: string
          enum: [EMAIL, SMS]
          description: Type of verification to resend
          example: EMAIL

    UserInfo:
      type: object
      properties:
        userId:
          type: string
          description: The user's ID
          format: uuid
          example: 2a3e0b5c-2192-4612-9e02-693989dbb7e5
        provider:
          type: string
          description: The authentication provider (e.g., local, google, github)
          example: local
        firstName:
          type: string
          description: The user's first name
          maxLength: 100
          example: John
        lastName:
          type: string
          description: The user's last name
          maxLength: 100
          example: Doe
        email:
          type: string
          description: The user's email address
          format: email
          maxLength: 254
          example: user@example.com
        emailVerified:
          type: boolean
          description: Whether the user's email address has been verified
          example: true
        imageUrl:
          type: string
          description: Optional URL to the user's profile image
          maxLength: 2048
          example: https://example.com/images/johndoe.jpg
        phoneNumber:
          type: string
          pattern: '^\+\d{1,20}$'
          maxLength: 20
          description: E.164 phone number for the user (e.g. +15551234567). May be null if not provided.
        phoneVerified:
          type: boolean
          description: Whether the user's phone number has been verified (null if no phone number)
          example: false
        roles:
          type: array
          description: List of roles assigned to the user
          nullable: true
          items:
            type: string
          example: ["USER", "ADMIN"]
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the user was created
          example: '2024-01-01T12:00:00Z'
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the user was last updated
          example: '2024-01-01T12:00:00Z'
        lastLoginAt:
          type: string
          format: date-time
          description: Timestamp when the user last logged in
          example: '2024-01-15T08:30:00Z'

    UsersPagedResponse:
      allOf:
        - $ref: '.gen/common-api.yaml#/components/schemas/PaginationMeta'
        - type: object
          properties:
            items:
              type: array
              items:
                $ref: '#/components/schemas/UserInfo'

    ChangePasswordRequest:
      type: object
      required:
        - oldPassword
        - newPassword
        - confirmPassword
      properties:
        oldPassword:
          $ref: '#/components/schemas/Password'
        newPassword:
          $ref: '#/components/schemas/Password'
        confirmPassword:
          $ref: '#/components/schemas/ConfirmPassword'

    AdminSetPasswordRequest:
      type: object
      required:
        - newPassword
        - confirmPassword
      properties:
        newPassword:
          $ref: '#/components/schemas/Password'
        confirmPassword:
          $ref: '#/components/schemas/ConfirmPassword'

    ChangeEmailRequest:
      type: object
      required:
        - newEmail
      properties:
        newEmail:
          type: string
          format: email
          maxLength: 254
          description: New email address
          example: user+new@example.com

    ResetPasswordRequest:
      type: object
      required:
        - email
        - token
        - newPassword
        - confirmPassword
      properties:
        email:
          type: string
          format: email
          maxLength: 254
          description: The user's email address
          example: user@example.com
        token:
          type: string
          description: Password reset token received via email
          example: abc123def456ghi789
        newPassword:
          $ref: '#/components/schemas/Password'
        confirmPassword:
          $ref: '#/components/schemas/ConfirmPassword'

    ForgotPasswordRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email
          maxLength: 254
          description: The user's email address
          example: user@example.com

    SuccessfulResponse:
      $ref: '.gen/common-api.yaml#/components/schemas/SuccessfulResponse'

  securitySchemes:
    bearerAuth:
      $ref: '.gen/common-api.yaml#/components/securitySchemes/bearerAuth'
